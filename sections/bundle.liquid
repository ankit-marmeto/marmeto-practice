{{ "quick-add.css" | asset_url | stylesheet_tag }}
<script src="{{ 'quick-add.js' | asset_url }}" defer="defer"></script>

<script src="{{ 'marmeto-product-recommendations.js' | asset_url }}" defer="defer"></script>

{{ "bundle.css" | asset_url | stylesheet_tag }}

<div class=" bundle__wrapper">

  <custom-product-form data-section-id="{{ section.id }}">
    {% if section.settings.heading != blank %}
      <h1 class="bundle__heading">{{ section.settings.heading }}</h1>
    {% endif %}

    <div class="page-width bundle__container">
      {% if recommendations.performed %}
        <div class="bundle__products">

          <div class="bundle__product">
            {% render 'gumazing-product-card'
              , product: recommendations.products.first %}
          </div>
          <button class="bundle__plus">+</button>
          <div class="bundle__product" data-product-id="{{ recommendations.products.last.selected_or_first_available_variant.id }}">
            {% render 'gumazing-product-card'
              , product: recommendations.products.last %}
          </div>
        </div>
        {% assign card_product = recommendations.products.first %}
        <div class="bundle__cta">
          <div class="bundle__price">
            {% assign price = recommendations.products.first.price | plus: recommendations.products.last.price | money %}
            {% assign compare_price = recommendations.products.first.compare_at_price | plus: recommendations.products.last.compare_at_price %}

            <div>Total :
              <span class="selling-price">{{ price }}</span>
              {% if compare_price != 0 %}
                {{ compare_price | money }}
              {% endif %}
            </div>

          </div>
          <div class="bundle__cta-buttons">
            <div class="bundle__quantity-selector">Quantity Selector</div>
            {% assign product_form_id = 'product-add-' | append: section.id %}
            <div class="bundle__add-to-cart-button">

              {%- form 'product'
                ,
 card_product
                ,
 id: product_form_id
                ,
 class: 'form'
                ,
 novalidate: 'novalidate'
                ,
 data-type: 'add-to-cart-form'
              -%}
                <input
                  type="hidden"
                  name="id"
                  value="{{ product.selected_or_first_available_variant.id }}"
                  class="product-variant-id"
                  {% if product.selected_or_first_available_variant.available == false %}
                  disabled
                  {% endif %}>
                <button
                  id="{{ product_form_id }}-submit"
                  type="submit"
                  name="add"
                  class="quick-add__submit bundle-add-button"
                  aria-haspopup="dialog"
                  aria-labelledby="{{ product_form_id }}-submit title-{{ section.id }}-{{ product.id }}"
                  aria-live="polite"
                  data-sold-out-message="true"
                  {% if product.selected_or_first_available_variant.available == false %}
                  disabled
                  {% endif %}>
                  <span>
                    {%- if product.selected_or_first_available_variant.available -%}
                      Add Both To Cart
                    {%- else -%}
                      {{ 'products.product.sold_out' | t }}
                    {%- endif -%}
                  </span>
                  <span class="sold-out-message hidden">
                    {{ 'products.product.sold_out' | t }}
                  </span>
                  {%- render 'loading-spinner' -%}
                </button>
              {%- endform -%}

            </div>
          </div>
        </div>
      {% endif %}
    </div>

    {% if section.settings.cutout != blank %}
      <div class="bundle__cutout-image">
        {% render 'responsive-picture'
          , desktopImage: section.settings.cutout
          , class: "image-fit" %}
      </div>
    {% endif %}

  </custom-product-form>

  <div
    class="mm-recommendations"
    data-base-url="{{ routes.product_recommendations_url }}"
    data-product-id="{{ product.id }}"
    data-section-id="{{ section.id }}"
    data-section-type="marmeto-product-recommendations"></div>
</div>

<style></style>

{% schema %}
  {
    "name": "Bundle",
    "class": "bundle section",
    "tag": "section",
    "settings": [
      {
        "type": "text",
        "id": "heading",
        "label": "Heading"
      },
      {
        "type": "color_background",
        "id": "background",
        "label": "Background"
      },
      {
        "type": "color",
        "id": "color",
        "label": "Color"
      },
      {
        "type": "image_picker",
        "id": "cutout",
        "label": "Bottom cutout image"
      }, {
        "type": "checkbox",
        "id": "enable_product_recommendations",
        "label": "Show product recommendations",
        "default": true
      }

    ],
    "presets": [
      {
        "name": "Bundle"
      }
    ]
  }
{% endschema %}